var viewRenderers = require('../views').renderer;

/**
allowedFormats
defaultFormat
name
layout
*/
var Base = module.exports = function(params) {
  if (params.allowedFormats) {
    var renderers = {};
    params.allowedFormats.forEach(function(type) {
      if (type in viewRenderers) renderers[type] = viewRenderers[type];
    });
    Object.defineProperty(this, '_renderers', {value:renderers});
  }
  
  Object.defineProperty(this, 'controllerName', {value:params.name, writable: true});
  Object.defineProperty(this, 'name', {get:function(){return this.controllerName;}, set:function(val){this.controllerName=val;}});
  if (params.layout) Object.defineProperty(this, '_layout', {value:params.layout});
  
  var defaultFormat = params.defaultFormat || 'html';
  Object.defineProperty(this, '_defaultFormat', {value:defaultFormat});
}

Base.prototype.index = function(req, res){
  var actionName = 'index';
  var options = {};
  options._actionName = actionName;
  options._view = this[actionName+'_view'] || actionName;
  options._layout = this[actionName+'_layout'] || this._layout || 'layout';
  options.title = this[actionName+'_title'] || actionName;
  res.respond(this, options);
};
Base.prototype.index_method = 'get';
Base.prototype.index_route = '';
Base.prototype.index_title = '';
