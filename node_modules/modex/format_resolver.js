var supportedFormats = require('./views').renderers;

exports = module.exports = function (){
  return function (req, res, next) {
    var format = req.query.format;
    if (format) { // format is explicitly specified in the query string
      if (format in supportedFormats) req.format = format;
      else req.format = 'default';
    } else { // no format is specified, use the http "accept" header
      //console.log(req.accepted);
      req.accepted.some(function(token){
        req.format = 'default';
        //console.log(supportedFormats);
        for (format in supportedFormats) {
          //console.log('format: '+ format);
          //console.log('token: ' + token);
          if (token.value.indexOf(format) > -1) {
            req.format = format;
            return true;
          }
        }
        return false;
      });
    }
    next();
  };
};