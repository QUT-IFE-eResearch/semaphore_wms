<h1>Working with Kepler Scientific Workflow</h1>
<p>
Kepler is a free software system for designing, executing, reusing, evolving, archiving, and sharing scientific workflows.
A workflow is represented in directed graphs where the nodes represent discrete computational components, and the edges represent paths along which data and results can flow between components.
In Kepler, the nodes are called 'Actors' and the edges are called 'channels'.
The Semaphore project provides Kepler component (Actors) to run Century and Daycent models, and other components to help running the simulation and process the output data. 
Download the provided example to learn on how to use Kepler to run the Century and Daycent models.
</p>
<p class="text-center"><img class="img-polaroid" src="/static/screenshots/kepler_example.png"/></p>
<br/>
<h2>Getting Started</h2>
<p>
  To get started, download the Kepler software from <a href="https://kepler-project.org/">https://kepler-project.org/</a>.
  Kepler runs on Windows, Mac, or Linux desktops. Java 1.6 or later is needed to run Kepler 2.4. 
  If you do not have Java 1.6 or later installed on your system, please installed it first from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a>.
  It is also recommended to install R from <a href="http://www.r-project.org">http://www.r-project.org</a> and add R to the environment PATH.
</p>
<p>
  Download the example Kepler workflow <a href="https://github.com/QUT-IFE-eResearch/semaphore/blob/master/kepler/sample-kar/kingaroy.kar?raw=true">here</a> and preferably put the file in the Kepler data directory. 
</p>
<p>
  Run Kepler and open the example workflow. To run the workflow, a local copy of Daycent model executable is needed. Please refer to <a href="http://www.nrel.colostate.edu/projects/daycent/">Daycent official website</a> to find out more about it.
</p>

<h2>Kepler Actors</h2>
The default Kepler installation comes with a range of built-in actors. The example workflow mainly uses the built-in actors by customising their parameters. 
For some operations that are very hard to achieve by just configuring the built-in actors, we need to write a custom python script using the Python Actor.
<dl>
<dt>File Copy</dt>
<dd>This actor is used to copy all of the model's input files from inputDir to outputDir. The purpose is to have a new directory that contains all input and output files for each model run.</dd>
<dt>DaycentSetupOutputFiles</dt>
<dd>
  This is a Python actor that reads configuration from outfiles.in file, provides an interface to change it, and save it back to the same outfiles.in file.
  Right click on the actor and choose configure actor to select the additional output files that need to be generated by the Daycent model.
  <p class="text-center"><img class="img-polaroid" src="/static/screenshots/kepler_actor_daycent_output_params.jpg"/></p>
</dd>
<dt>Model Execution</dt>
<dd>This actor runs an external command, which is configured to run Daycent model located under the $basePath/daycent directory.</dd>
<dt>LIST100 Execution</dt>
<dd>This actor runs an external command, which is configured to run a tool that process the binary output of Daycent to textual output.</dd>
<dt>CSV to Array</dt>
<dd>This actor reads a CSV file and outputs the data in forms of arrays of String tokens.</dd>
<dt>Array Element</dt>
<dd>This actor extract an element from the array. This actor selects a column for each row of the input array.</dd>
<dt>Array String to Double</dt>
<dd>This actor converts array of String values to array of Double values</dd>
<dt>DaycentOut to Array</dt>
<dd>This actor reads the Daycent .out file, which is a space delimited values, and outputs the data in forms of arrays of String tokens.</dd>
<dt>Transform Soil Water</dt>
<dd>This actor adjust the output of Daycent simulation by weighting the soil water content for each layer to match with the the actual measurement.</dd>
<dt>Array Plotter</dt>
<dd>This actor plots the values of the input array to a chart.</dd>

</dl>
<h2>Using the Example</h2>
<p>First the following parameters need to be configured:</p>
<ul>
  <li>basePath: The path of a parent directory that should contain other directories specified in other parameters.</li>
  <li>inputDir: The directory name that should contain all the input files for Daycent.</li>
  <li>outputDir: The directory that will contains the daycent output files after the simulation finishes.</li>
  <li>scheduleName: The name of the schedule file to be run, excluding the .sch extension name</li>
  <li>prevScheduleName: The name of existing binary output file that will be extended.</li>
  <li>String Constant Outvars: List of the Daycent output parameters that will be generated.</li>
  <li>String Constant Output: Daycent output data to be processed and displayed.</li>
  <li>String Constant Measurement: Measurement data to be processed and displayed.</li>
</ul>
<p>After configuring the constants, run the workflow and wait until the Daycent simulation finishes. 
Three plots will be displayed on the screen showing the measurement data and the simulated data for soil water content at layers 0-10, 10-20, and 20-30.
</p>
<p class="text-center"><img class="img-polaroid" src="/static/screenshots/kepler_example_plots.jpg"/></p>
